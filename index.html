<html>
	
 <head>
     <script type="text/javascript" src="js/phaser.min.js"></script>
 </head>

 <body>
    <script>
     var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

     function preload() {
         game.load.image('sky', 'assets/sky.png');
         game.load.image('ground', 'assets/platform.png');
         game.load.image('star', 'assets/star.png');
         game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
     }


     var player;
     var platforms;
     var cursors;
     var stars;

     function create() {
         game.physics.startSystem(Phaser.Physics.ARCADE); //abilita la fisica
         game.add.sprite(0, 0, 'sky'); //aggiunge il cielo

         platforms = game.add.group(); //il platform contiene la terra e le due sporgenze su cui possiamo saltare
         platforms.enableBody = true; //Noi abiliteremo la fisica per tutti gli oggetti che sono stati creati in questo gruppo

         var ground = platforms.create(0, game.world.height - 64, 'ground'); //adesso creiamo il ground
         ground.scale.setTo(2, 2); //Scaliamo il ground per adattarlo alla larghezza del gioco (la sprite originale è 400x32)
         ground.body.immovable = true; // questo impedisce la caduta del ground

         var ledge = platforms.create(400, 400, 'ground'); // Adesso creiamo le due sporgenze
         ledge.body.immovable = true;
         ledge = platforms.create(-150, 250, 'ground');
         ledge.body.immovable = true;

         player = game.add.sprite(32, game.world.height - 150, 'dude');
         game.physics.arcade.enable(player); //abilità la fisica al player

         player.body.bounce.y = 0.2;              /*impostiamo fisica rimbalzo*/
         player.body.gravity.y = 300;             /*impostiamo la gravita*/
         player.body.collideWorldBounds = true;   /*impostiamo collisioni*/

         player.animations.add('left', [0, 1, 2, 3], 10, true); //animazione cammina a sinistra
         player.animations.add('right', [5, 6, 7, 8], 10, true); //animazione cammina a destra

         game.camera.follow(player);        //la camera segue il movimento del player

         cursors = game.input.keyboard.createCursorKeys(); //creiamo i controlli

         stars = game.add.group(); //creaiamo il gruppo stars
         stars.enableBody = true; //abilitiamo tutte le stelle che sono state create in questo gruppo

         for (var i = 0; i < 12; i++) {
             var star = stars.create(i * 70, 0, 'star'); //creaiamo una star nel gruppo stars
             star.body.gravity.y = 300; //impostiamo il valore della gravita
             star.body.bounce.y = 0.7 + Math.random() * 0.2; //diamo alla stella un valore di rimbalzo casuale
         }
     }

     function update() {


         game.physics.arcade.collide(player, platforms); //collisione tra il personaggio e il platform.
         game.physics.arcade.collide(stars, platforms); //collisione tra le stelle e il platform

         game.physics.arcade.overlap(player, stars, collectStar, null, this); /* se c'è un overlap tra  players e stars viene invocato il metodo collectStar*/

         player.body.velocity.x = 0; //reset la velocità del player


         if (cursors.left.isDown) {
             player.body.velocity.x = -150; //Muovi a sinistra

             player.animations.play('left');
         }
         else if (cursors.right.isDown) {
             player.body.velocity.x = 150; //Muovi a destra

             player.animations.play('right');
         }
         else {
             player.animations.stop();
             player.frame = 4;
         }

         if (cursors.up.isDown && player.body.touching.down) { //permette di saltare se è premuto il tasto verso l'alto
             player.body.velocity.y = -100;
         }

     }

     function collectStar(player, star) {

         // Removes the star from the screen
         star.kill();

     }
   </script>
 </body>

</html>